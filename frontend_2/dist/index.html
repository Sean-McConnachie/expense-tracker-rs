<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Getting Started</title>
  </head>
  <body>
	<script src="https://unpkg.com/mustache@latest"></script>
	<script src="bundle.js"></script>
	<link rel="stylesheet" href="style.css">

	<main>
		<div
			id="login-msg-target"
			class="overlay hidden"
			onclick="document.getElementById('login-msg-target').classList.toggle('hidden')">
			Please login!
		</div>

		<!-- ID PREFIX: `add-expense` -->
		<div id="add-expense-target"></div>
		<script id="add-expense-template" type="x-tmpl-mustache">
			<div class="overlay">
        		<div class="popup popup-show">
        	    	<span
						class="popup-close"
						onclick="document.getElementById('add-expense-target').innerHTML = ``">X</span>
        	    	<div class="popup-header">
        	        	<h2 style="text-align: center;">Add Expense</h2>
						Currently logged in as <b>{{current_user}}</b>.

        	    	</div>
					
					<h4 id="expense-error" class="popup-error"></h4>

					<div class="popup-flex-div">
						<div style="flex: 1;">
			                <label for="category">Category</label>
			                <select
								id="category"
								name="category"
								style="width: 100%;">
			                    
								<option selected=true disabled=true hidden=true value="">Select Category</option>
								{{#categories}}
								<option value={{@index}}>{{name}}</option>
								{{/categories}}
			                </select>

							<label for="description">Description</label>
			                <textarea
								id="description"
								name="description"
								style="width: 100%;"></textarea>

							<label for="date">Date</label>
							<input
								type="date"
								value={{current_date}}
								id="date"
								name="date"
								style="width: 100%; margin: 0px 0px 20px; padding: 10px;">
							</input>
			            </div>

			            <div style="flex: 1;">
							<!-- Amounts table -->
							<table>
  							  	<tr>
  							    	<th></th>
  							    	<th>Person</th>
  							    	<th>Share</th>
  							  	</tr>
								
								{{#users}}
								<tr>
									<td><input checked=true type="checkbox" class="user-checked"></td>
									<td>{{username}}</td>
                        	      	<td>
										<input
											type="number"
											step="0.01"
											class="user-amount number-input"
											value="0.00"
											uid={{@index}}></td>
								</tr>
								{{/users}}

								<tr class="sum-row">
								  <td colspan="2">Total</td>
								  <td>
								  	<input
								  		type="number"
										step="0.01"
										class="number-input"
										value="0.00"
										id="total"></td>
								</tr>
  							</table>
						<!-- / Ammounts table -->
			            </div>
			        </div>
			        <div class="popup-footer">
			            <button type="submit" id="submit-expense" class="submit-button">Submit</button>
					</div>
				</div>
			</div>
		</script>
		<!-- END: `add-expense` -->
		
		<header>
            <div class="header-left">
				<!-- ID PREFIX: `user-dd` -->
				<div id="user-dd-target">Loading...</div>
				<script id="user-dd-template" type="x-tmpl-mustache">
					<select id="user-dd-select" class="user-dropdown">
                	    <option selected=true disabled=true hidden=true value="">Select user</option>
						{{#users}}
						<option value={{@index}}>{{username}}</option>
						{{/users}}
                	</select>
				</script>
				<!-- END: `user-dd` -->

                <button id="add-expense" class="add-expense-btn btn"><i class="fas fa-plus"></i></button>
            </div>
            <div class="header-center">
                <h1>Expense Tracker</h1>
            </div>
            <div class="header-right">
                <button class="settings-btn btn"><i class="fas fa-cog"></i></button>
                <div class="settings-menu">
                    <ul>
                        <li><a href="#">Edit users</a></li>
						<li><a href="#">Edit categories</a></li>
                    </ul>
                </div>
            </div>
        </header>

		<section>
			<div class="expenses-section">
				<div class="expenses-left">
					<div class="expense-header">
						<h2>Expenses</h2>
						<!-- Filter goes here? -->
					</div>
					<!-- ID PREFIX: `expense` -->
					<div id="expense-target">Loading...</div>
					<script id="expense-template" type="x-tmpl-mustache">
						<ul class="expenses-list">
							{{#entries}}
							<li>
								<input value={{@index}} type="checkbox" class="expense-checkbox" checked={{checked}} />
								<div class="expense-row"
									onclick="document.getElementById('detail-{{@index}}').classList.toggle('hidden')">
									<div class="expense-amount">${{rnd2DP amount}}</div>
									<div class="expense-date">{{pretty_date}}</div>
									<div class="expense-category">{{category_name}}</div>
									<div class="expense-user">{{username}}</div>
									<div class="expense-communal">{{is_communal}}</div>
									<div class="expense-users">{{num_users}}</div>
    				    		</div>

								<div class="expense-details hidden" id="detail-{{@index}}">
									<div class="expense-description"><p>{{description}}</p></div>
            					    <table class="expense-users-table">
            					        <thead>
            					            <tr>
												<th><b>Name</b></th>
            					                <th><b>Amount</b></th>
            					                <th><b>Share (%)</b></th>
            					            </tr>
            					        </thead>
            					        <tbody>
											{{#user_owes}}
											<tr>
												<td>{{name}}</td>
												<td>{{rnd2DP amount}}</td>
												<td>{{rnd2DP perc}}</td>
                							</tr>
											{{/user_owes}}
            					        </tbody>
            					    </table>
            					</div>
    				    	</li>
							{{/entries}}
						</ul>
					</script>
					<!-- END: `expense` -->
				</div>
				
				<!-- Expenses summary -->
				<div id="expense-summary-target"></div>
				<script id="expense-summary-template" type="x-tmpl-mustache">
				<div class="expenses-right">
					<div class="expenses-summary">
            		    <h2>Total</h2>
						<div class="expenses-total">${{rnd2DP total}}</div>
            		</div>
            		<div class="expenses-summary">
						<table class="expenses-owes-table">
                    	    <thead>
                    	        <tr>
                    	            <th>{"Name"}</th>
                    	            <th>{"Owes ($)"}</th>
                    	        </tr>
                    	    </thead>
                    	    <tbody>
                    	        {sub_owing}
                    	    </tbody>
                    	</table>
					</div>
            		<div class="expenses-summary">
            		    <h2>Categories</h2>
            		    <ul class="expenses-categories">
							{{#categories}}
							<li>{{this}}</li>
							{{/categories}}
            		    </ul>
            		</div>
				</div>
				</script>
				<!-- Expenses summary ending -->
			</div>
		</section>
	</main>
  </body>
</html>

